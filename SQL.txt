CREATE TABLE [dbo].[Users] (
    [UserId]           INT            IDENTITY (1, 1) NOT NULL,
    [Username]         NVARCHAR (50)  NOT NULL,
    [Password]         NVARCHAR (MAX) NOT NULL,
    [FirstName]        NVARCHAR (100) NULL,
    [LastName]         NVARCHAR (100) NULL,
    [CountryId]        INT            NULL,
    [DateOfBirth]      DATETIME       NULL,
    [RegistrationDate] DATETIME       DEFAULT (getdate()) NOT NULL,
    [Email]            NVARCHAR (50)  NOT NULL,
    [IsActive]         BIT            DEFAULT ((1)) NOT NULL,
    [MailVerified]     BIT            DEFAULT ((0)) NOT NULL,
    [VerificationCode] NVARCHAR(MAX) NULL, 
    [VerificationDate] DATETIME NULL, 
    PRIMARY KEY CLUSTERED ([UserId] ASC),
    CONSTRAINT [Unique_Mail] UNIQUE NONCLUSTERED ([Email] ASC),
    CONSTRAINT [Unique_Username] UNIQUE NONCLUSTERED ([Username] ASC),
    CONSTRAINT [FK_User_Country] FOREIGN KEY ([CountryId]) REFERENCES [dbo].[Countries] ([Id])
);



CREATE TABLE [dbo].[Questions] (
    [Id]         INT           IDENTITY (1, 1) NOT NULL,
    [Name]       VARCHAR (255) NOT NULL,
    [Weight]     INT           DEFAULT ((0)) NOT NULL,
    [IsActive]   BIT           DEFAULT ((1)) NOT NULL,
    [CreatorId]  INT           NOT NULL,
    [CreateDate] DATETIME      DEFAULT (getdate()) NOT NULL,
    [IsApproved] BIT           DEFAULT ((0)) NOT NULL,
    [Positive]   INT           DEFAULT ((0)) NOT NULL,
    [Negative]   INT           DEFAULT ((0)) NOT NULL,
    [IsComplex]  BIT           DEFAULT ((1)) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    CONSTRAINT [Unique_Name] UNIQUE NONCLUSTERED ([Name] ASC),
    CONSTRAINT [FK_Creator_User] FOREIGN KEY ([CreatorId]) REFERENCES [dbo].[Users] ([UserId]),
    CONSTRAINT [Check_Weight] CHECK ([Weight]>(0) AND [Weight]<=(10))
);



CREATE TABLE [dbo].[UserLanguages] (
	[Id]		 INT NOT NULL IDENTITY,
    [UserId]     INT NOT NULL,
    [LanguageId] INT NOT NULL,
	PRIMARY KEY CLUSTERED ([Id] ASC),
	CONSTRAINT [Unique_Set] UNIQUE NONCLUSTERED ([UserId], [LanguageId]),
    CONSTRAINT [FK_User] FOREIGN KEY ([UserId]) REFERENCES [dbo].[Users] ([UserId]),
    CONSTRAINT [FK_Language] FOREIGN KEY ([LanguageId]) REFERENCES [dbo].[Languages] ([Id])
);

    


CREATE TABLE [dbo].[Languages] (
    [Id]           INT           IDENTITY (1, 1) NOT NULL,
    [Name]         VARCHAR (255) NOT NULL,
    [FlagURL]      VARCHAR (MAX) NULL,
    [IsActive]     BIT           DEFAULT ((1)) NOT NULL,
    [OriginalName] VARCHAR (255) NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);


CREATE TABLE [dbo].[QuestionOptions] (
    [Id]         INT            IDENTITY (1, 1) NOT NULL,
    [QuestionId] INT            NOT NULL,
    [LanguageId] INT            NOT NULL,
    [Content]    NVARCHAR (255) NOT NULL,
    [Weight]     INT            DEFAULT ((1)) NOT NULL,
    [IsActive]   BIT            DEFAULT ((1)) NOT NULL,
    [CreatorId]  INT            NOT NULL,
    [CreateDate] DATETIME       DEFAULT (getdate()) NOT NULL,
    [IsApproved] BIT            DEFAULT ((0)) NOT NULL,
    [Positive]   INT            DEFAULT ((0)) NOT NULL,
    [Negative]   INT            DEFAULT ((0)) NOT NULL,
    [IsComplex]  BIT            DEFAULT ((1)) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    CONSTRAINT [QuestionOption_Unique_Name] UNIQUE NONCLUSTERED ([QuestionId], [Content], [LanguageId]),
    CONSTRAINT [FK_QuestionId] FOREIGN KEY ([QuestionId]) REFERENCES [dbo].[Questions] ([Id]),
    CONSTRAINT [FK_QuestionLanguage] FOREIGN KEY ([LanguageId]) REFERENCES [dbo].[Languages] ([Id]),
    CONSTRAINT [FK_QuestionOption_Creator] FOREIGN KEY ([CreatorId]) REFERENCES [dbo].[Users] ([UserId]),
    CONSTRAINT [QuestionOption_Check_Weight] CHECK ([Weight]>(0) AND [Weight]<=(10))
);




CREATE TABLE [dbo].[QuestionCategories] (
    [Id]       INT            IDENTITY (1, 1) NOT NULL,
    [Name]     NVARCHAR (255) NOT NULL,
    [ParentId] INT            NULL,
    [IsActive]   BIT           DEFAULT ((1)) NOT NULL,
    [CreatorId]  INT           NOT NULL,
    [CreateDate] DATETIME      DEFAULT (getdate()) NOT NULL,
    [IsApproved] BIT           DEFAULT ((0)) NOT NULL,
    [Positive]   INT           DEFAULT ((0)) NOT NULL,
    [Negative]   INT           DEFAULT ((0)) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    FOREIGN KEY ([ParentId]) REFERENCES [dbo].[QuestionCategories] ([Id])
);


CREATE TABLE [dbo].[WordCategories] (
    [Id]       INT            IDENTITY (1, 1) NOT NULL,
    [Name]     NVARCHAR (255) NOT NULL,
    [ParentId] INT            NULL,
    [IsActive]   BIT           DEFAULT ((1)) NOT NULL,
    [CreatorId]  INT           NOT NULL,
    [CreateDate] DATETIME      DEFAULT (getdate()) NOT NULL,
    [IsApproved] BIT           DEFAULT ((0)) NOT NULL,
    [Positive]   INT           DEFAULT ((0)) NOT NULL,
    [Negative]   INT           DEFAULT ((0)) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    FOREIGN KEY ([ParentId]) REFERENCES [dbo].[WordCategories] ([Id])
);



CREATE TABLE [dbo].[MatchQuestionCategory]
(
	[Id]       INT            IDENTITY (1, 1) NOT NULL,
	[QuestionId] INT NOT NULL,
	[CategoryId] INT NOT NULL,
    [IsActive]   BIT           DEFAULT ((1)) NOT NULL,
    [CreatorId]  INT           NOT NULL,
    [CreateDate] DATETIME      DEFAULT (getdate()) NOT NULL,
    [IsApproved] BIT           DEFAULT ((0)) NOT NULL,
    [Positive]   INT           DEFAULT ((0)) NOT NULL,
    [Negative]   INT           DEFAULT ((0)) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    FOREIGN KEY ([QuestionId]) REFERENCES [dbo].[Questions] ([Id]),
	FOREIGN KEY ([CategoryId]) REFERENCES [dbo].[QuestionCategories] ([Id])
)



CREATE TABLE [dbo].[MatchWordCategory]
(
	[Id]       INT            IDENTITY (1, 1) NOT NULL,
	[MetawordId] INT NOT NULL,
	[CategoryId] INT NOT NULL,
    	[IsActive]   BIT           DEFAULT ((1)) NOT NULL,
    	[CreatorId]  INT           NOT NULL,
    	[CreateDate] DATETIME      DEFAULT (getdate()) NOT NULL,
    	[IsApproved] BIT           DEFAULT ((0)) NOT NULL,
    	[Positive]   INT           DEFAULT ((0)) NOT NULL,
    	[Negative]   INT           DEFAULT ((0)) NOT NULL,
    	PRIMARY KEY CLUSTERED ([Id] ASC),
    	FOREIGN KEY ([MetawordId]) REFERENCES [dbo].[Metawords] ([Id]),
	FOREIGN KEY ([CategoryId]) REFERENCES [dbo].[WordCategories] ([Id])
)




========================================

CREATE TABLE [dbo].[WordTypes]
(
	[Id] INT NOT NULL PRIMARY KEY,
	[Name] NVARCHAR(255) NOT NULL
)


CREATE TABLE [dbo].[Metawords]
(
    [Id] INT IDENTITY (1, 1) NOT NULL,
	[Name] NVARCHAR(255) NOT NULL UNIQUE,
	[Type] INT NOT NULL,
    [IsActive]   BIT           DEFAULT ((1)) NOT NULL,
    [CreatorId]  INT           NOT NULL,
    [CreateDate] DATETIME      DEFAULT (getdate()) NOT NULL,
    [IsApproved] BIT           DEFAULT ((0)) NOT NULL,
    [Positive]   INT           DEFAULT ((0)) NOT NULL,
    [Negative]   INT           DEFAULT ((0)) NOT NULL,
	PRIMARY KEY CLUSTERED ([Id] ASC),
	CONSTRAINT [FK_WordType] FOREIGN KEY ([Type]) REFERENCES [dbo].[WordTypes] ([Id])
)



CREATE TABLE [dbo].[Words]
(
	[Id] INT IDENTITY (1, 1) NOT NULL,
	[MetawordId] INT NOT NULL,
	[LanguageId] INT NOT NULL,
	[Name] NVARCHAR(255) NOT NULL,
    [IsActive]   BIT           DEFAULT ((1)) NOT NULL,
    [CreatorId]  INT           NOT NULL,
    [CreateDate] DATETIME      DEFAULT (getdate()) NOT NULL,
    [IsApproved] BIT           DEFAULT ((0)) NOT NULL,
    [Positive]   INT           DEFAULT ((0)) NOT NULL,
    [Negative]   INT           DEFAULT ((0)) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    FOREIGN KEY ([MetawordId]) REFERENCES [dbo].[Metawords] ([Id]),
	FOREIGN KEY ([LanguageId]) REFERENCES [dbo].[Languages] ([Id]),
	CONSTRAINT [Word_Unique_Content] UNIQUE NONCLUSTERED ([MetawordId], [Name], [LanguageId])
)



CREATE TABLE [dbo].[Grammar]
(
    [Id] INT IDENTITY (1, 1) NOT NULL,
    [WordId] INT NOT NULL,
    [Content] NVARCHAR(255) NOT NULL,
    [Definition] NVARCHAR(255) NOT NULL,
    [IsActive]   BIT           DEFAULT ((1)) NOT NULL,
    [CreatorId]  INT           NOT NULL,
    [CreateDate] DATETIME      DEFAULT (getdate()) NOT NULL,
    [IsApproved] BIT           DEFAULT ((0)) NOT NULL,
    [Positive]   INT           DEFAULT ((0)) NOT NULL,
    [Negative]   INT           DEFAULT ((0)) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    FOREIGN KEY ([WordId]) REFERENCES [dbo].[Words] ([Id]),
    CONSTRAINT [Unique_Grammar_Form] UNIQUE NONCLUSTERED ([WordId], [Definition])
)





CREATE TABLE [dbo].[VariantSets]
(
    [Id] INT IDENTITY (1, 1) NOT NULL,
    [QuestionOptionId] INT NOT NULL,
    [VariantTag] NVARCHAR(255) NOT NULL,
    [IsActive]   BIT           DEFAULT ((1)) NOT NULL,
    [CreatorId]  INT           NOT NULL,
    [CreateDate] DATETIME      DEFAULT (getdate()) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    FOREIGN KEY ([QuestionOptionId]) REFERENCES [dbo].[QuestionOptions] ([Id]),
    CONSTRAINT [Unique_Variant_Tag] UNIQUE NONCLUSTERED ([QuestionOptionId], [VariantTag])
)




CREATE TABLE [dbo].[Variants]
(
    [Id] INT IDENTITY (1, 1) NOT NULL,
    [VariantSetId] INT NOT NULL,
    [Key]	 NVARCHAR(255) NOT NULL,
    [Content]	 NVARCHAR(255) NOT NULL,
    [IsActive]   BIT           DEFAULT ((1)) NOT NULL,
    [CreatorId]  INT           NOT NULL,
    [CreateDate] DATETIME      DEFAULT (getdate()) NOT NULL,
    [IsApproved] BIT           DEFAULT ((0)) NOT NULL,
    [Positive]   INT           DEFAULT ((0)) NOT NULL,
    [Negative]   INT           DEFAULT ((0)) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    FOREIGN KEY ([VariantSetId]) REFERENCES [dbo].[VariantSets] ([Id]),
    CONSTRAINT [Unique_Variant_Content] UNIQUE NONCLUSTERED ([VariantSetId], [Key])
)




CREATE TABLE [dbo].[VariantConnections]
(
    [Id] INT IDENTITY (1, 1) NOT NULL,
    [VariantSetId] INT NOT NULL,
    [ConnectedSetId] INT NOT NULL,
    [IsActive]   BIT           DEFAULT ((1)) NOT NULL,
    [CreatorId]  INT           NOT NULL,
    [CreateDate] DATETIME      DEFAULT (getdate()) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    FOREIGN KEY ([VariantSetId]) REFERENCES [dbo].[VariantSets] ([Id]),
    FOREIGN KEY ([ConnectedSetId]) REFERENCES [dbo].[VariantSets] ([Id]),
    CONSTRAINT [Unique_Variant_Connection] UNIQUE NONCLUSTERED ([VariantSetId], [ConnectedSetId]),
    CONSTRAINT [Different_Variants] CHECK ([VariantSetId]<>[ConnectedSetId])
)



CREATE TABLE [dbo].[VariantLimits]
(
    [Id] INT IDENTITY (1, 1) NOT NULL,
    [VariantId] INT NOT NULL,
    [ConnectedVariantId] INT NOT NULL,
    [IsActive]   BIT           DEFAULT ((1)) NOT NULL,
    [CreatorId]  INT           NOT NULL,
    [CreateDate] DATETIME      DEFAULT (getdate()) NOT NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC),
    FOREIGN KEY ([VariantId]) REFERENCES [dbo].[Variants] ([Id]),
    FOREIGN KEY ([ConnectedVariantId]) REFERENCES [dbo].[Variants] ([Id]),
    CONSTRAINT [Unique_Variant_Limit] UNIQUE NONCLUSTERED ([VariantId], [ConnectedVariantId]),
    CONSTRAINT [Different_Limits] CHECK ([VariantId]<>[ConnectedVariantId])
)